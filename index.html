<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modify and Download Existing TXT File</title>
    <style>
        body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; margin: 0; background-color: #f0f0f0; }
        button { padding: 10px 20px; font-size: 16px; cursor: pointer; background-color: #28a745; color: white; border: none; border-radius: 5px; }
        button:hover { background-color: #218838; }
        #statusMessage { margin-top: 20px; color: #333; }
    </style>
</head>
<body>

    <h1>Modify Existing Text File</h1>
    <input type="file" id="fileInput" accept=".txt" style="display: none;">
    <button onclick="triggerFileSelection()">Select and Modify TXT File</button>
    <p id="statusMessage"></p>

    <script>
        function triggerFileSelection() {
            document.getElementById('fileInput').click();
        }

        document.getElementById('fileInput').addEventListener('change', function(event) {
            const file = event.target.files[0]; // Get the selected file
            const statusMessage = document.getElementById('statusMessage');

            if (!file) {
                statusMessage.textContent = "No file selected.";
                return;
            }

            if (!file.name.toLowerCase().endsWith('.txt')) {
                statusMessage.textContent = "Please select a .txt file.";
                // Clear the input so the same file can be selected again if needed
                event.target.value = '';
                return;
            }

            statusMessage.textContent = `Processing "${file.name}"...`;

            const reader = new FileReader();

            reader.onload = function(e) {
                const originalContent = e.target.result; // The content of the original file

                // --- STEP 4: Modify the content in memory ---
                // Example modification: Add a timestamp and a header/footer
                const timestamp = new Date().toLocaleString();
                const modifiedContent = `--- MODIFIED ON ${timestamp} ---\n` +
                                        originalContent +
                                        `\n--- END OF MODIFICATION ---`;

                // --- STEP 5: Offer the modified content for download ---
                // Suggest a new name to avoid direct overwrite surprise,
                // or use originalFileName if you want the browser to prompt for overwrite.
                const newFileName = file.name.replace(/(\.txt)$/i, '_modified$1'); // e.g., mydoc.txt -> mydoc_modified.txt
                downloadModifiedFile(modifiedContent, newFileName);
                statusMessage.textContent = `"${newFileName}" is ready for download!`;

                // Clear the input value so selecting the same file again triggers change event
                event.target.value = '';
            };

            reader.onerror = function(e) {
                console.error("Error reading file:", e.target.error);
                statusMessage.textContent = "Error reading the file.";
                event.target.value = '';
            };

            reader.readAsText(file); // Read the file as text
        });

        function downloadModifiedFile(content, filename) {
            const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);

            const a = document.createElement('a');
            a.href = url;
            a.download = filename; // The suggested filename for the download

            // Appending and clicking an element makes sure the download happens
            document.body.appendChild(a);
            a.click();

            // Clean up the temporary URL and element
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
    </script>

</body>
</html>
